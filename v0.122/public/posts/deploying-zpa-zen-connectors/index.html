<!DOCTYPE html>
<html lang="map[author:map[bio:Engineer // Melbourne // Australia name:Nathan Catania photo:map[url:avatar.png]] contenttypename:posts dateform:Jan 2, 2006 dateformnum:2006-01-02 dateformnumtime:2006-01-02 15:04 &#43;1000 dateformshort:Jan 2 description:The official website of Nathan Catania &amp;#10003; disablereadotherposts:false enablethemetoggle:true giturl:https://github.com/nathancatania/website/commit/ homesubtitle:Engineer // Melbourne // Australia images:[] keywords:blog, website, official logo:map[logohomelink:/ logotext:$ cd /home/nathan] readotherposts:Read other posts social:[map[name:linkedin url:https://www.linkedin.com/in/nathancatania]] subtitle:Engineer // Melbourne // Australia]">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Engineer // Melbourne // Australia Nathan Catania map[url:avatar.png] ">
<meta name="description" content="These notes will cover how to deploy a ZEN Connector for Zscaler Private Access (ZPA)" />
<meta name="keywords" content="blog, website, official, azure, zscaler, lab, notes" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://nathancatania.com/posts/deploying-zpa-zen-connectors/" />


    <title>
        
            Deploying ZPA ZEN Connectors :: Nathan Catania  — Engineer // Melbourne // Australia
        
    </title>





<link rel="stylesheet" href="/main.b851fae37ea32930b5c4996a9ac8737a9d1ab1b40af28b3cd3b0060df9e2f5a3.css" integrity="sha256-uFH6436jKTC1xJlqmshzep0asbQK8os807AGDfni9aM=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="Deploying ZPA ZEN Connectors">
<meta itemprop="description" content="These notes will cover how to deploy a ZEN Connector for Zscaler Private Access (ZPA)"><meta itemprop="datePublished" content="2020-01-05T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-01-05T00:00:00+00:00" />
<meta itemprop="wordCount" content="2369"><meta itemprop="image" content="https://nathancatania.com" />
<meta itemprop="keywords" content="azure,zscaler,lab,notes," />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://nathancatania.com" /><meta name="twitter:title" content="Deploying ZPA ZEN Connectors"/>
<meta name="twitter:description" content="These notes will cover how to deploy a ZEN Connector for Zscaler Private Access (ZPA)"/>



    <meta property="og:title" content="Deploying ZPA ZEN Connectors" />
<meta property="og:description" content="These notes will cover how to deploy a ZEN Connector for Zscaler Private Access (ZPA)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nathancatania.com/posts/deploying-zpa-zen-connectors/" /><meta property="og:image" content="https://nathancatania.com" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-01-05T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-01-05T00:00:00+00:00" />







    <meta property="article:published_time" content="2020-01-05 00:00:00 &#43;0000 UTC" />











    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                $ cd /home/nathan</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/posts">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>12 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="https://nathancatania.com/posts/deploying-zpa-zen-connectors/">Deploying ZPA ZEN Connectors</a>
            </h1>
                <hr />
                <aside id="toc">
                <div class="toc-title">Table of Contents</div>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#connector-provisioning">Connector Provisioning</a>
      <ul>
        <li><a href="#step-1---provisioning-key">Step 1 - Provisioning Key</a></li>
        <li><a href="#step-2---signing-certificate">Step 2 - Signing Certificate</a></li>
        <li><a href="#step-3---connector-groups">Step 3 - Connector Groups</a></li>
        <li><a href="#step-4---provisioning-key-details">Step 4 - Provisioning Key Details</a></li>
        <li><a href="#step-5-6---review-selection-and-generate-the-provisioning-key">Step 5-6 - Review Selection and Generate the Provisioning Key</a></li>
        <li><a href="#next-steps">Next Steps</a></li>
      </ul>
    </li>
    <li><a href="#connector-minimum-requirements">Connector Minimum Requirements</a>
      <ul>
        <li><a href="#requirement-1---deploy-connectors-in-pairs">Requirement 1 - Deploy Connectors in pairs</a></li>
        <li><a href="#requirement-2---compute-resources-per-connector">Requirement 2 - Compute Resources per Connector</a></li>
        <li><a href="#requirement-3---static-mac-address">Requirement 3 - Static MAC address</a></li>
        <li><a href="#requirement-4---internal-and-external-dns-resolution">Requirement 4 - Internal and External DNS Resolution</a></li>
        <li><a href="#requirement-5---outbound-connectivity-on-port-443">Requirement 5 - Outbound connectivity on port 443</a></li>
        <li><a href="#requirement-6---bypass-ssl-inspection">Requirement 6 - Bypass SSL Inspection</a></li>
        <li><a href="#static-ips--dhcp">Static IPs &amp; DHCP</a></li>
      </ul>
    </li>
    <li><a href="#connector-deployment---vmware-vsphere-esxi">Connector Deployment - VMware vSphere (ESXi)</a></li>
    <li><a href="#connector-configuration--housekeeping">Connector Configuration &amp; Housekeeping</a>
      <ul>
        <li><a href="#change-the-default-password">Change the default password</a></li>
        <li><a href="#set-network-information">Set Network Information</a></li>
        <li><a href="#enable-ssh-temporarily-or-permanently">Enable SSH (temporarily or permanently)</a></li>
        <li><a href="#highly-recommended-manually-update-the-connector">[Highly Recommended] Manually Update the Connector</a></li>
        <li><a href="#view-connector-logs">View Connector Logs</a></li>
        <li><a href="#start-stop-or-restart-the-connector-service">Start, Stop, or Restart the Connector Service</a></li>
      </ul>
    </li>
    <li><a href="#enrolling-the-connector">Enrolling the Connector</a></li>
    <li><a href="#verifying-connector-status-and-health">Verifying Connector Status and Health</a></li>
    <li><a href="#next-steps-1">Next Steps</a></li>
  </ul>
</nav>
                </aside>
                <hr />

            
                <img src="banner.png" class="post-cover" />
            

            <div class="post-content">
                <blockquote>
<p>Disclaimer: I am an employee of Zscaler. These are my own notes from a ZPA homelab deployment and may be incorrect or against best practice. You should consult the <a href="https://help.zscaler.com">Zscaler help portal</a> for official documentation.</p>
</blockquote>
<h1 id="connector-provisioning">Connector Provisioning</h1>
<p>First, we are going to define the connector in the ZPA admin portal and generate the required provisioning key. The provisioning key authenticates the connector when it calls home to the ZPA cloud (via it&rsquo;s established control channel), and associates it to your ZPA instance.</p>
<p>Log into the ZPA admin portal and navigate using the side menu to <strong>Administration</strong> &gt; <strong>Connectors</strong>.</p>
<figure><img src="zc1.png"
         alt="Access Connector management from the Administration menu"/><figcaption>
            <p>Access Connector management from the Administration menu</p>
        </figcaption>
</figure>

<p>In the top-right corner, click <strong>Add Connector</strong> to open the wizard workflow.</p>
<h2 id="step-1---provisioning-key">Step 1 - Provisioning Key</h2>
<p>Create a new provisioning key, or choose an existing one if you already have one that is able to be used.</p>
<p>If you elect to use an existing key, ensure it has not reached the maximum number of uses defined or the connector connector provisioning will fail. You can alter how many times an existing key can be used under <strong>Administration</strong> &gt; <strong>Connector Provisioning Keys</strong>.</p>
<p>Click <strong>Next</strong>.</p>
<p><img src="zc2.png" alt="2"></p>
<h2 id="step-2---signing-certificate">Step 2 - Signing Certificate</h2>
<p>Next choose the intermediate CA to be used to sign the identity and server certificates on the connector. When prompted, select <strong>Connector</strong>, then click <strong>Next</strong>.</p>
<p><img src="zc3.png" alt="3"></p>
<h2 id="step-3---connector-groups">Step 3 - Connector Groups</h2>
<p>Create a new <strong>Connector Group</strong>, or select an existing one.</p>
<p>Connector Groups are a logical grouping of connectors, and help facilitate high availability and horizontal scaling. Each connector belongs to a specific Connector Group. Connectors are updated weekly and are brought down and up again for automatic software updates on a round-robin basis within the group.</p>
<p>If creating a new group, you will need to specify a 4 hour weekly upgrade interval in which all connectors within this group will take turns automatically updating and rebooting. You will also need to specify the geographic location of the connectors in the group.</p>
<p>When you are finished, click <strong>Next</strong>.</p>
<p><img src="zc4.png" alt="4"></p>
<h2 id="step-4---provisioning-key-details">Step 4 - Provisioning Key Details</h2>
<p>If in Step 1 you elected to create a NEW Provisioning Key, you will be prompted to <strong>give it a name and set the MAXIMUM number of times it can be re-used</strong> for other new connectors. This is an API enforced value, meaning it can be changed from within the ZPA admin portal (Administration &gt; Connector Provisioning Keys) at a later stage.</p>
<p>It may be worth setting a key re-usabilty value based on the number of connectors you plan on deploying in a single Connector Group. This will assist you when it comes to scaling your connectors for a specific LAN segment.</p>
<p><strong>Any connectors deployed with this Provisioning Key will be named after the key, so you&rsquo;ll want to give it a descriptive name.</strong> For example, a key with the name &lsquo;Melbourne&rsquo;, will have its associated connectors automatically named <code>Melbourne-1</code>, <code>Melbourne-2</code>, and so on.</p>
<p>If you elected to use an existing key, you will be shown how many times it has already been used.</p>
<p>Click <strong>Next</strong> when ready.</p>
<p><img src="zc5.png" alt="5"></p>
<h2 id="step-5-6---review-selection-and-generate-the-provisioning-key">Step 5-6 - Review Selection and Generate the Provisioning Key</h2>
<p>Once you have reviewed the information on the <strong>Review</strong> tab, click <strong>Save</strong>.</p>
<p><strong>Your Provisioning Key will be generated and displayed.</strong></p>
<p><strong>IMPORTANT: This key is CONFIDENTIAL INFORMATION and should be stored securely.</strong> Depending on the number of times you specified the key can be re-used, anyone with your provisioning key could deploy a connector and have it associated with your Connector Group and ZPA instance. Treat it like an API key and secure it.</p>
<p>Selecting a deployment platform at the bottom of the window will load an inline help article from <code>help.zscaler.com</code> guiding you through the deployment process.</p>
<p><img src="zc6.png" alt="6"></p>
<h2 id="next-steps">Next Steps</h2>
<p>Click <strong>Done</strong> when you are ready.</p>
<p><strong>Only connectors that have been BOTH provisioned and enrolled will show up under Administration &gt; Connectors!</strong> We have provisioned the connector in the admin portal, but still need to deploy the connector and wait until it calls home to the ZPA cloud to enroll itself. Only then will it show in the list.</p>
<p>You can click on the <strong>Connector Groups</strong> tab or <strong>Connector Provisioning Keys</strong> tab at the top to review these details respectively.</p>
<h1 id="connector-minimum-requirements">Connector Minimum Requirements</h1>
<h2 id="requirement-1---deploy-connectors-in-pairs">Requirement 1 - Deploy Connectors in pairs</h2>
<p>Zscaler recommends you deploy connectors in pairs. Why? To ensure high-availability of your private applications.</p>
<p>As you would have specified when creating a Connector Group above, connectors have a weekly scheduled slot in which they perform an automatic software update. This causes the connector briefly go offline as it needs to reboot to complete the update process. Connectors in a group are never updated at the same time.</p>
<p>Hence, if you deploy connectors (at least) in pairs, when one connector begins to update, your applications will still be accessible through the second connector. When the first connector comes back up, the second connector will begin to update. This process repeats until all connectors in a group are updated.</p>
<h2 id="requirement-2---compute-resources-per-connector">Requirement 2 - Compute Resources per Connector</h2>
<p>Every connector has the following minimum resource requirements:</p>
<ul>
<li>2 vCPUs</li>
<li>4GB RAM</li>
<li>8GB Disk (~1GB thin provisioning)</li>
<li>1 NIC</li>
</ul>
<p>This provides each connector with a maximum throughput capacity of ~500 Mbps. If you need to scale beyond that, Zscaler recommends you deploy multiple connectors rather than simply increasing the resources allocated to the connector VM. This has an added bonus of increasing your overall resiliency to connector failure.</p>
<p>In a lab environment, you will get away with 2GB RAM allocation, but this is not supported.</p>
<h2 id="requirement-3---static-mac-address">Requirement 3 - Static MAC address</h2>
<p>The connector must have a static MAC address.</p>
<p>This is to do with the virtual hardware fingerprinting that ZPA does for connectors. MAC address is one element used to generate the unique fingerprint. If the MAC is changed at all, including on reboot, then the fingerprint will have been altered and the connector access to the ZPA cloud will be blocked for security reasons.</p>
<h2 id="requirement-4---internal-and-external-dns-resolution">Requirement 4 - Internal and External DNS Resolution</h2>
<p>The connector must be able to resolve both internal and external hostnames.</p>
<p>The connector should be deployed on the same LAN segment as the private applications it is providing access to.</p>
<h2 id="requirement-5---outbound-connectivity-on-port-443">Requirement 5 - Outbound connectivity on port 443</h2>
<p>The connector requires outbound access on port 443 in order to function. No inbound ports are required to be open.</p>
<p>For a complete list outbound firewall rules required, see <a href="https://ips.zscaler.net/zpa">https://ips.zscaler.net/zpa</a></p>
<h2 id="requirement-6---bypass-ssl-inspection">Requirement 6 - Bypass SSL Inspection</h2>
<p>You cannot do SSL inspection or decryption on any traffic coming from a connector. Only the Zscaler ZPA certificates are trusted. If the connector sees another certificate other than the ZPA one (due to how SSL inspection works), it will not pass traffic for security reasons.</p>
<p>You must bypass SSL inspection/decryption for connector traffic.</p>
<p>If you are using Zscaler Internet Access (ZIA), then the bypasses are automatically done for you.</p>
<h2 id="static-ips--dhcp">Static IPs &amp; DHCP</h2>
<p>Both static assignment of networking details and DHCP are supported connectors. Given that a connector is a key piece of networking infrastructure, static addressing is recommended.</p>
<h1 id="connector-deployment---vmware-vsphere-esxi">Connector Deployment - VMware vSphere (ESXi)</h1>
<p>For this guide, I&rsquo;ll be using the free vSphere Hypervisor (6.7).</p>
<ol>
<li>
<p>Download the connector OVA using the URL below:</p>
<p><a href="https://dist.private.zscaler.com/vms/VMware/2018.10/zpa-connector-2018.10.ova">https://dist.private.zscaler.com/vms/VMware/2018.10/zpa-connector-2018.10.ova</a></p>
<p>If you are using vCenter, then you should be able to simply paste in the URL to the OVF deployment tool.</p>
</li>
<li>
<p>Login to the vSphere UI. Select <strong>Virtual Machines</strong> from the side menu and select <strong>Create / Register VM</strong> at the top-left.</p>
</li>
<li>
<p>Select option 2 <strong>Deploy a virutal machine from an OVF or OVA file</strong>, then on the next screen give the VM a name (I called mine <code>Z-Connector-1</code> and <code>Z-Connector-2</code>), and click to upload the <code>ZPA_Connector.ova</code> file.</p>
</li>
</ol>
<p><img src="esx1.png" alt="7"></p>
<ol start="4">
<li>Select storage options, click <strong>Next</strong>, then select the network segement you wish to deploy the connector to. This should ideally be the same LAN segment that some of your applications are on.
For <strong>Disk Provisioning</strong>, leave it set to <strong>Thin</strong>.</li>
</ol>
<p><img src="esx3.png" alt="8"></p>
<ol start="5">
<li>Review your settings and click <strong>Finish</strong> to deploy the OVA.</li>
</ol>
<p>If you get an <code>Unsupported attribute 'initialBoot' on element 'InstallSection'</code> error when deploying, try again using one one of the OVAs below:</p>
<ul>
<li>If you are using vSphere:
<a href="https://dist.private.zscaler.com/vms/VMware/Latest/ZPA_Connector_Basic.ova">https://dist.private.zscaler.com/vms/VMware/Latest/ZPA_Connector_Basic.ova</a></li>
<li>If you are using vCenter
<a href="https://dist.private.zscaler.com/vms/VMware/Latest/ZPA_Connector_Basic.ova">https://dist.private.zscaler.com/vms/VMware/Latest/ZPA_Connector.ova</a></li>
</ul>
<p>If you are still hitting the error, try updating your ESXi client.</p>
<h1 id="connector-configuration--housekeeping">Connector Configuration &amp; Housekeeping</h1>
<p>Here we will login to the connector, change the default password, set network information (if not obtained via DHCP), and (optionally) enable SSH.</p>
<p>We will also manually update the connector from the command line. <strong>This is highly recommended the first time you deploy a connector.</strong></p>
<p>Some of these steps may only be required if you deployed the connector as a VM, and not as a package or in AWS/Azure.</p>
<p>It may take 15 minutes for the default <code>admin</code> user to be created. If login to the connector initially fails, wait some time and then try again.</p>
<h2 id="change-the-default-password">Change the default password</h2>
<ol>
<li>Log in to the connector using the <strong>username</strong> <code>admin</code> and <strong>default password</strong> <code>zscaler</code></li>
</ol>
<p><img src="cli1.png" alt="9"></p>
<ol start="2">
<li>
<p>Use the <code>passwd</code> command to change the current password for the <code>admin</code> user</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ passwd 
</span></span><span style="display:flex;"><span>Changing password <span style="color:#66d9ef">for</span> user admin. 
</span></span><span style="display:flex;"><span>Changing password <span style="color:#66d9ef">for</span> admin. 
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>current<span style="color:#f92672">)</span> UNIX password:
</span></span><span style="display:flex;"><span>New password:
</span></span><span style="display:flex;"><span>Retype new password:
</span></span><span style="display:flex;"><span>passwd: all authentication tokens updated successfully. 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$
</span></span></code></pre></div></li>
<li>
<p>Log out of the connector when finished.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ logout
</span></span></code></pre></div></li>
</ol>
<h2 id="set-network-information">Set Network Information</h2>
<p>VM based connectors are set to use DHCP by default. Alternatively, to set static information:</p>
<ol>
<li>
<p>To set a static IP address, edit <code>/etc/sysconfig/network-scripts/ifcfg-eth0</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo nano /etc/sysconfig/network-scripts/ifcfg-eth0
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>DEVICE<span style="color:#f92672">=</span>eth0
</span></span><span style="display:flex;"><span>BOOTPROTO<span style="color:#f92672">=</span>none
</span></span><span style="display:flex;"><span>ONBOOT<span style="color:#f92672">=</span>yes
</span></span><span style="display:flex;"><span>NETWORK<span style="color:#f92672">=</span>10.0.10.0
</span></span><span style="display:flex;"><span>NETMASK<span style="color:#f92672">=</span>255.255.255.0
</span></span><span style="display:flex;"><span>IPADDR<span style="color:#f92672">=</span>10.0.10.16
</span></span><span style="display:flex;"><span>USERCTL<span style="color:#f92672">=</span>no
</span></span></code></pre></div></li>
<li>
<p>To set the default gateway, edit <code>/etc/sysconfig/network</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo nano /etc/sysconfig/network
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>NETWORKING<span style="color:#f92672">=</span>yes 
</span></span><span style="display:flex;"><span>GATEWAY<span style="color:#f92672">=</span>10.0.10.1
</span></span></code></pre></div></li>
<li>
<p>To set DNS (connectors must be able to resolve internal and external hostnames), edit <code>/etc/resolv.conf</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo nano /etc/resolv.conf
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>nameserver 10.0.10.2
</span></span><span style="display:flex;"><span>nameserver 10.0.10.22 
</span></span><span style="display:flex;"><span>search example.com
</span></span></code></pre></div></li>
<li>
<p>To set NTP servers, edit <code>/etc/chrony.conf</code>
These should ideally be internal NTP servers.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo nano /etc/chrony.conf
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>server 0.zscaler.pool.ntp.org iburst
</span></span><span style="display:flex;"><span>server 1.zscaler.pool.ntp.org iburst
</span></span><span style="display:flex;"><span>server 2.zscaler.pool.ntp.org iburst
</span></span><span style="display:flex;"><span>server 3.zscaler.pool.ntp.org iburst
</span></span></code></pre></div></li>
<li>
<p>Restart the <code>network</code> and <code>chronyd</code> services for your changes to take effect.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo systemctl restart network
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo systemctl restart chronyd
</span></span></code></pre></div></li>
</ol>
<p>The Zscaler <a href="https://help.zscaler.com/zpa/connector-deployment-guide-vmware-platforms">documentation</a> has additonal information on how to:</p>
<ul>
<li>Configure additional network interfaces</li>
<li>Set static routes</li>
<li>Configure the connector and/or yum to use a Proxy Server.</li>
</ul>
<h2 id="enable-ssh-temporarily-or-permanently">Enable SSH (temporarily or permanently)</h2>
<p>To <strong>temporarily</strong> enable SSH:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo systemctl start sshd
</span></span></code></pre></div><p>This will persist until next reboot. You can use <code>stop</code> in place of <code>start</code> to disable SSH once you are done.</p>
<p>To <strong>permanently</strong> enable SSH, also run the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo systemctl enable sshd
</span></span></code></pre></div><h2 id="highly-recommended-manually-update-the-connector">[Highly Recommended] Manually Update the Connector</h2>
<p>Update the system packages:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo yum update -y
</span></span></code></pre></div><p>Reboot the connector (preferred) or restart the <code>zpa-connector</code> service:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo reboot
</span></span><span style="display:flex;"><span>OR
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo systemctl restart zpa-connector
</span></span></code></pre></div><p>The Zscaler <a href="https://help.zscaler.com/zpa/managing-deployed-connectors#upgradingtheconnectorpackage">documentation</a> covers alternative scenarios, such as updating with a proxy server, or without access to the package repository.</p>
<h2 id="view-connector-logs">View Connector Logs</h2>
<p>Use <code>journalctl</code> to view the logs for the <code>zpa-connector</code> service:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo journalctl -u zpa-connector
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>-------- Connector Status:ID<span style="color:#f92672">=</span>144133100000000000:Name<span style="color:#f92672">=</span>Homelab Key-1:Ver<span style="color:#f92672">=</span>19.65.2 --------
</span></span><span style="display:flex;"><span>Certificate will expire in <span style="color:#ae81ff">377</span> days, <span style="color:#ae81ff">23</span> hours, <span style="color:#ae81ff">47</span> minutes, <span style="color:#ae81ff">38</span> seconds
</span></span><span style="display:flex;"><span>Control connection state: fohh_connection_connected, local:<span style="color:#f92672">[</span>10.0.10.30<span style="color:#f92672">]</span>:53040 
</span></span><span style="display:flex;"><span>remote:broker1c.syd4.prod.zpath.net...2.196<span style="color:#f92672">]</span>:443
</span></span><span style="display:flex;"><span>RPC Messages: BrkRq <span style="color:#f92672">=</span> 0, BrkRqAck <span style="color:#f92672">=</span> 0|0, BindReq <span style="color:#f92672">=</span> 0|0, BindReqAck <span style="color:#f92672">=</span> 0, ...
</span></span><span style="display:flex;"><span>Broker data connection count <span style="color:#f92672">=</span> 0, backed_off connections <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>Data Transfer: Total ToBroker <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> bytes, Total FromBroker <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> bytes
</span></span><span style="display:flex;"><span>Mtunnels: Total Created <span style="color:#f92672">=</span> 0, Total Freed <span style="color:#f92672">=</span> 0, Current Active <span style="color:#f92672">=</span> 0, Alloc <span style="color:#f92672">=</span> 0, ...
</span></span><span style="display:flex;"><span>Registered apps count <span style="color:#f92672">=</span> 0, alive app <span style="color:#f92672">=</span> 0, passive_health <span style="color:#f92672">=</span> 0, service_count <span style="color:#f92672">=</span> 0, ...
</span></span><span style="display:flex;"><span>Time skew: + 0.000000s
</span></span><span style="display:flex;"><span>Control channel successfully connected to Zscaler Cloud
</span></span><span style="display:flex;"><span>Connector- waiting <span style="color:#66d9ef">for</span> time synchronization
</span></span><span style="display:flex;"><span>Connector- Time synchronized, Local time - 737.427447s <span style="color:#f92672">=</span> cloud_time
</span></span><span style="display:flex;"><span>zscaler-update: Zscaler software update: Currently installed version verified as 19.65.2
</span></span></code></pre></div><p>This can also be dumped to a file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo journalctl -u zpa-connector &gt; zpa-logs.txt
</span></span></code></pre></div><h2 id="start-stop-or-restart-the-connector-service">Start, Stop, or Restart the Connector Service</h2>
<p>The ZPA connector runs as a service called <code>zpa-connector and can be controlled via </code>systemctl`:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo systemctl start zpa-connector
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo systemctl stop zpa-connector
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo systemctl restart zpa-connector
</span></span></code></pre></div><p>You can also check the status of the connector service:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo systemctl status zpa-connector
</span></span></code></pre></div><h1 id="enrolling-the-connector">Enrolling the Connector</h1>
<p>In this section we will provide the connector with the Provisioning Key (PK) and complete its enrollment. After this step, you will see the connector listed in the admin portal.</p>
<p>You must stop the <code>zpa-connector</code> service first. If the connector does not detect the PK after it boots, it will only check for it again once every 24 hours.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo systemctl stop zpa-connector
</span></span></code></pre></div><p>Create a file <code>/opt/zscaler/var/provision_key</code> with permissions <code>644</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo touch /opt/zscaler/var/provision_key
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo chmod <span style="color:#ae81ff">644</span> /opt/zscaler/var/provision_key
</span></span></code></pre></div><p>Copy the PK into the <code>provision_key</code> file. Make sure you encase it in double quotes <code>&quot; &quot;</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo echo <span style="color:#e6db74">&#34;&lt;Your-Provisioning-Key&gt;&#34;</span> | sudo tee /opt/zscaler/var/provision_key
</span></span></code></pre></div><p>Note: <strong>Beware of the type of double quotation marks you use</strong> when you paste in the provisioning key! If you&rsquo;re copying and pasting into a console window, this can be auto-corrected to a left or right quotation mark (Unicode <code>U+201C</code> and <code>U+201D</code>) instead of the standard neutral double quotes (Unicode <code>U+0022</code>). If this happens the command will fail and the provisioning key will be incorrect.</p>
<p>You might be better off manually typing <code>sudo echo &quot;</code>, pasting the provisioning key, manually typing the closing quote mark, then pasting the remaining part of the command <code> | sudo tee /opt/zscaler/var/provision_key</code>.</p>
<p>Check the key is correct:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo cat /opt/zscaler/var/provision_key
</span></span></code></pre></div><p>Start the <code>zpa-connector</code> service again:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>admin@zpa-connector ~<span style="color:#f92672">]</span>$ sudo systemctl start zpa-connector
</span></span></code></pre></div><p>Check the logs (see above) to verify enrollment progress.</p>
<h1 id="verifying-connector-status-and-health">Verifying Connector Status and Health</h1>
<p>If the connector has been enrolled successfully, you&rsquo;ll now see it present in the list of connectors under <strong>Administration</strong> &gt; <strong>Connectors</strong>.</p>
<p><img src="zc7.png" alt="10"></p>
<p>Don&rsquo;t worry if some of the fields have not populated yet.</p>
<p>You can check the health of the connector under the <strong>Dashboard</strong> &gt; <strong>Health</strong> tab.</p>
<p><img src="zc8.png" alt="11"></p>
<p>This tab will only show healthy connectors by default.</p>
<h1 id="next-steps-1">Next Steps</h1>
<p>Congratulations! You&rsquo;ve deployed your first ZPA connector!
Now go and repeat the same process for a second one so they are deployed in a pair.</p>
<p>In the next guide we&rsquo;ll define some Applications in the admin portal and get them working with the connector(s).</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://nathancatania.com/tags/azure">azure</a></span><span class="tag"><a href="https://nathancatania.com/tags/zscaler">zscaler</a></span><span class="tag"><a href="https://nathancatania.com/tags/lab">lab</a></span><span class="tag"><a href="https://nathancatania.com/tags/notes">notes</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>2369 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2020-01-05</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Read other posts</span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="https://nathancatania.com/posts/pihole-dns-doh/">
                                <span class="button__icon">←</span>
                                <span class="button__text">Configure Pi-Hole DNS &#43; Cloudflare DNS over HTTPS (DoH) on a Raspberry Pi</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="https://nathancatania.com/posts/configuring-zscaler-zpa-to-use-azure-ad/">
                                <span class="button__text">Integrate Zscaler ZPA with Azure AD</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2024</span>
            
                <span><a href="https://nathancatania.com">Nathan Catania</a></span>
            
            <span> <a href="https://nathancatania.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span><a href="https://github.com/nathancatania/website">Source</a></span>
            <span><a href="https://github.com/rhazdon">Theme</a></span>
        </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.858712b4b19060b33e6a3b52df9749f413894a75772f4d0b4683380c0ce08c6f93623d63068ef5ae4719980bcaa15ad536694c42897b88c4826c6ece21918827.js" integrity="sha512-hYcStLGQYLM&#43;ajtS35dJ9BOJSnV3L00LRoM4DAzgjG&#43;TYj1jBo71rkcZmAvKoVrVNmlMQol7iMSCbG7OIZGIJw=="></script>




    </body>
</html>
