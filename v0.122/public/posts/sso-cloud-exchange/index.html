<!DOCTYPE html>
<html lang="map[author:map[bio:Engineer // Melbourne // Australia name:Nathan Catania photo:map[url:avatar.png]] contenttypename:posts dateform:Jan 2, 2006 dateformnum:2006-01-02 dateformnumtime:2006-01-02 15:04 &#43;1000 dateformshort:Jan 2 description:The official website of Nathan Catania &amp;#10003; disablereadotherposts:false enablethemetoggle:true giturl:https://github.com/nathancatania/website/commit/ homesubtitle:Engineer // Melbourne // Australia images:[] keywords:blog, website, official logo:map[logohomelink:/ logotext:$ cd /home/nathan] readotherposts:Read other posts social:[map[name:linkedin url:https://www.linkedin.com/in/nathancatania]] subtitle:Engineer // Melbourne // Australia]">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Engineer // Melbourne // Australia Nathan Catania map[url:avatar.png] ">
<meta name="description" content="This post will cover how to configure Single-Sign-On (SSO) with both Azure AD and Okta for the Netskope Cloud Exchange platform." />
<meta name="keywords" content="blog, website, official, netskope, sso, azure, okta, lab, notes" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://nathancatania.com/posts/sso-cloud-exchange/" />


    <title>
        
            How-to Configure SSO for Netskope Cloud Exchange :: Nathan Catania  — Engineer // Melbourne // Australia
        
    </title>





<link rel="stylesheet" href="/main.b851fae37ea32930b5c4996a9ac8737a9d1ab1b40af28b3cd3b0060df9e2f5a3.css" integrity="sha256-uFH6436jKTC1xJlqmshzep0asbQK8os807AGDfni9aM=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="How-to Configure SSO for Netskope Cloud Exchange">
<meta itemprop="description" content="This post will cover how to configure Single-Sign-On (SSO) with both Azure AD and Okta for the Netskope Cloud Exchange platform."><meta itemprop="datePublished" content="2022-03-06T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-03-06T00:00:00+00:00" />
<meta itemprop="wordCount" content="3053"><meta itemprop="image" content="https://nathancatania.com" />
<meta itemprop="keywords" content="netskope,sso,azure,okta,lab,notes," />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://nathancatania.com" /><meta name="twitter:title" content="How-to Configure SSO for Netskope Cloud Exchange"/>
<meta name="twitter:description" content="This post will cover how to configure Single-Sign-On (SSO) with both Azure AD and Okta for the Netskope Cloud Exchange platform."/>



    <meta property="og:title" content="How-to Configure SSO for Netskope Cloud Exchange" />
<meta property="og:description" content="This post will cover how to configure Single-Sign-On (SSO) with both Azure AD and Okta for the Netskope Cloud Exchange platform." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://nathancatania.com/posts/sso-cloud-exchange/" /><meta property="og:image" content="https://nathancatania.com" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-03-06T00:00:00+00:00" />







    <meta property="article:published_time" content="2022-03-06 00:00:00 &#43;0000 UTC" />











    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                $ cd /home/nathan</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/posts">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
                <span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
   <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
   3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
   13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
 </svg></span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>15 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="https://nathancatania.com/posts/sso-cloud-exchange/">How-to Configure SSO for Netskope Cloud Exchange</a>
            </h1>
                <hr />
                <aside id="toc">
                <div class="toc-title">Table of Contents</div>
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#azure-active-directory-azure-ad">Azure Active Directory (Azure AD)</a>
      <ul>
        <li><a href="#create-a-new-enterprise-application">Create a new Enterprise Application</a></li>
        <li><a href="#copy-the-cloud-exchange-sso-information">Copy the Cloud Exchange SSO information</a></li>
        <li><a href="#create-roles-in-azure-ad">Create Roles in Azure AD</a></li>
        <li><a href="#configure-the-cloud-exchange-enterprise-app-in-azure-ad">Configure the Cloud Exchange Enterprise App in Azure AD</a>
          <ul>
            <li><a href="#provide-the-saml-configuration">Provide the SAML Configuration</a></li>
            <li><a href="#add-claims-for-username--roles">Add Claims for Username &amp; Roles</a></li>
            <li><a href="#download-the-saml-signing-certificate">Download the SAML Signing Certificate</a></li>
            <li><a href="#copy-the-azure-ad-application-urls">Copy the Azure AD Application URLs</a></li>
          </ul>
        </li>
        <li><a href="#add-users--groups-to-the-enterprise-application">Add Users &amp; Groups to the Enterprise Application</a></li>
        <li><a href="#finish-the-sso-configuration-in-cloud-exchange">Finish the SSO Configuration in Cloud Exchange</a>
          <ul>
            <li><a href="#copy-the-azure-app-urls">Copy the Azure app URLs</a></li>
            <li><a href="#copy-the-saml-signing-certificate">Copy the SAML Signing Certificate</a></li>
          </ul>
        </li>
        <li><a href="#testing-the-sso-configuration">Testing the SSO Configuration</a></li>
        <li><a href="#troubleshooting">Troubleshooting</a></li>
      </ul>
    </li>
    <li><a href="#okta">Okta</a>
      <ul>
        <li><a href="#create-a-new-app-integration">Create a new App Integration</a></li>
        <li><a href="#copy-the-cloud-exchange-sso-information-1">Copy the Cloud Exchange SSO information</a></li>
        <li><a href="#configure-okta-saml-integration">Configure Okta SAML Integration</a>
          <ul>
            <li><a href="#copy-the-cloud-exchange-service-provider-urls">Copy the Cloud Exchange Service Provider URLs</a></li>
            <li><a href="#set-the-name-id-format">Set the Name ID format</a></li>
            <li><a href="#add-additional-attributes">Add additional attributes</a></li>
            <li><a href="#finish-the-saml-configuration">Finish the SAML configuration</a></li>
            <li><a href="#open-the-okta-saml-20-steup-instructions">Open the Okta SAML 2.0 Steup Instructions</a></li>
          </ul>
        </li>
        <li><a href="#create-the-roles-attribute-in-okta">Create the <code>roles</code> attribute in Okta</a></li>
        <li><a href="#configure-user-groups-for-ce-access">Configure User Groups for CE Access</a>
          <ul>
            <li><a href="#create-the-read-only-and-admin-groups">Create the <code>Read-Only</code> and <code>Admin</code> groups</a></li>
            <li><a href="#assign-people-to-the-read-only-role">Assign people to the Read-Only role</a></li>
            <li><a href="#assign-people-to-the-admin-role">Assign people to the Admin role</a></li>
          </ul>
        </li>
        <li><a href="#finish-the-sso-configuration-in-cloud-exchange-1">Finish the SSO Configuration in Cloud Exchange</a></li>
        <li><a href="#testing-the-sso-configuration-1">Testing the SSO Configuration</a></li>
        <li><a href="#troubleshooting-1">Troubleshooting</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </aside>
                <hr />

            
                <img src="banner.png" class="post-cover" />
            

            <div class="post-content">
                <blockquote>
<p>The thoughts and opinions in this post are my own and do not reflect those of Netskope. Please follow this guide at your own risk.</p>
</blockquote>
<p>This post will cover how to configure Single-Sign-On (SSO) for the Netskope Cloud Exchange (CE) platform; specifically for Azure AD and Okta. This will allow you to manage administrator access to CE from within your existing Identity Provider (IdP), rather than configuring administrators within the platform manually.</p>
<p>Cloud Exchange is different from the standard Netskope tenant you would have access to as a customer and facilitates the exchange of information between your various security and operations platforms. For information on what Cloud Exchange is (including how to deploy it), please <a href="/posts/deploy-netskope-cloud-exchange">see here</a>.</p>
<h1 id="azure-active-directory-azure-ad">Azure Active Directory (Azure AD)</h1>
<p><img src="26.png" alt="26"></p>
<h2 id="create-a-new-enterprise-application">Create a new Enterprise Application</h2>
<p>Log into the Azure AD <a href="https://portal.azure.com">portal</a>, and go to &ldquo;Enterprise Applications&rdquo;. You may need to search for this at the top of the portal.</p>
<p><img src="1.png" alt="1"></p>
<p>Click <strong>New application</strong>.</p>
<p><img src="2.png" alt="2"></p>
<p>Click <strong>Create your own application</strong> and name the application <code>Netskope Cloud Exchange</code>.</p>
<p>Select the 3rd option to create a non-gallery app: <strong>Integrate any other application you don&rsquo;t find in the gallery</strong>.</p>
<p>Click <strong>Create</strong> when you are done.</p>
<p><img src="3.png" alt="3"></p>
<p>Note, that Azure can sometimes have a quirk where it returns a 404 error when you click the <strong>Create</strong> button. Your application has should have been created, even if you get this error. If you encounter this issue, return to the <strong>Enterprise Applications</strong> view and click the refresh button. You should see your <em>Netskope Cloud Exchange</em> app appear in the list, despite getting a 404.</p>
<h2 id="copy-the-cloud-exchange-sso-information">Copy the Cloud Exchange SSO information</h2>
<p>Log in to Cloud Exchange using the <code>admin</code> (super administrator) user, and navigate to <strong>Settings &gt; Users</strong> (this settings area will only be visible to the <code>admin</code> user).</p>
<p>Select the <strong>SSO Configuration</strong> tab, and toggle the <strong>SSO</strong> toggle <strong>ON</strong> (make sure you save this configuration).</p>
<p>Note down the 3x &ldquo;Service Provider&rdquo; fields at the bottom of the screen. The image below maps which URL should be used for which SAML config field in Azure AD.</p>
<p><img src="6.png" alt="6"></p>
<h2 id="create-roles-in-azure-ad">Create Roles in Azure AD</h2>
<p>Users can be assigned Read/Write or just Read access to the CE UI based on one of two roles assigned to them: <code>Admin</code> (read/write access) and <code>Read Only</code>. We need to create these roles in Azure AD so that they can be assigned to users who use the CE application.</p>
<p><strong>Note: If you don&rsquo;t create and map these roles then SSO will fail!</strong></p>
<p>Return to the <strong>main</strong> Azure Active Directory menu (ensure you are NOT within the <em>Enterprise Applications</em> sub-menu). Select <strong>App registrations</strong> from the left-side menu, click the <em><strong>All applications</strong></em> tab, then select the <strong>Netskope Cloud Exchange</strong> app from the list.</p>
<p><img src="8.png" alt="8"></p>
<p>Next, click <strong>App Roles</strong> from the left-side menu, followed by <strong>Create app role</strong>. You will be creating two roles: One for the Admin user role and one for the Read-Only user role.</p>
<p>Create the <strong>Admin</strong> role as follows:</p>
<ul>
<li>For <em><strong>Display name</strong></em>, enter <code>CE-Admin</code> (this can be whatever you like)</li>
<li>For <em><strong>Allowed member types</strong></em>, select the first option: <code>Users/Groups</code></li>
<li>For <em><strong>Value</strong></em>, enter <code>netskope-ce-write;netskope-ce-read</code> &lt;- Ensure you copy/paste this exactly!</li>
<li>For <em><strong>Description</strong></em>, enter <code>Provide the user with read/write access to Cloud Exchange.</code></li>
<li>Ensure the <em><strong>Do you want to enable this app role?</strong></em> option is <strong>checked</strong>.</li>
</ul>
<p><img src="9.png" alt="9"></p>
<p>Create the <strong>Read-Only</strong> role as follows:</p>
<ul>
<li>For <em><strong>Display name</strong></em>, enter <code>CE-ReadOnly</code> (this can be whatever you like)</li>
<li>For <em><strong>Allowed member types</strong></em>, select the first option: <code>Users/Groups</code></li>
<li>For <em><strong>Value</strong></em>, enter <code>netskope-ce-read</code> &lt;- Ensure you copy/paste this exactly!</li>
<li>For <em><strong>Description</strong></em>, enter <code>Provide the user with read-only access to Cloud Exchange.</code></li>
<li>Ensure the <em><strong>Do you want to enable this app role?</strong></em> option is <strong>checked</strong>.</li>
</ul>
<p><img src="10.png" alt="10"></p>
<p>You&rsquo;re now finished configuring the App Roles. Return to the main Azure AD menu to proceed.</p>
<h2 id="configure-the-cloud-exchange-enterprise-app-in-azure-ad">Configure the Cloud Exchange Enterprise App in Azure AD</h2>
<p>From the Azure AD main menu, return to the <em>Enterprise Applications</em> list and select <strong>Netskope Cloud Exchange</strong> to configure it.</p>
<p><img src="4.png" alt="4"></p>
<p>From the left-side menu, click <strong>Single sign-on</strong>, and select <strong>SAML</strong> when prompted.</p>
<p><img src="5.png" alt="5"></p>
<h3 id="provide-the-saml-configuration">Provide the SAML Configuration</h3>
<p>Under <strong>Basic SAML Configuration</strong>, click the <em>Edit</em> button.</p>
<p>Copy the &ldquo;Service Provider&rdquo; URLs from the Cloud Exchange SSO Configuration page to the appropriate Azure AD SAML config field. See the table below for mapping.</p>
<table>
<thead>
<tr>
<th>Azure AD SAML Field</th>
<th>Cloud Exchange Field</th>
</tr>
</thead>
<tbody>
<tr>
<td>Identifier (Entity ID)</td>
<td>Service Provider Entity ID</td>
</tr>
<tr>
<td>Reply URL (Assertion Consumer Service URL)</td>
<td>Service Provider ACS URL</td>
</tr>
<tr>
<td>Sign on URL</td>
<td>Service Provider ACS URL</td>
</tr>
<tr>
<td>Relay State</td>
<td>N/A - Leave Blank</td>
</tr>
<tr>
<td>Logout URL</td>
<td>Service Provider SLS URL</td>
</tr>
</tbody>
</table>
<p>The <em>Reply URL</em> and <em>Sign-on URL</em> in Azure AD both use the Service Provider ACS URL from the Cloud Exchange portal. The <em>Relay State</em> field in Azure AD should be left blank.</p>
<p><img src="7.png" alt="7"></p>
<p>Save your configuration when done.</p>
<h3 id="add-claims-for-username--roles">Add Claims for Username &amp; Roles</h3>
<p>Click <strong>Edit</strong> next the <strong>Attributes &amp; Claims</strong> section (section #2)</p>
<p><img src="11.png" alt="11"></p>
<p>Click the button to <strong>Add new claim</strong>. Add a new claim as follows:</p>
<ul>
<li>For the <em>Name</em> field, enter <code>roles</code> &lt;&ndash; Enter this exactly!</li>
<li>Leave <em><strong>Namespace</strong></em> blank.</li>
<li>For <em><strong>Source</strong></em>, ensure <code>Attribute</code> is selected (default).</li>
<li>For <em><strong>Source attribute</strong></em>, select <code>user.assignedroles</code> from the dropdown.</li>
</ul>
<p>Click <strong>Save</strong> to add the claim.</p>
<p><img src="12.png" alt="12"></p>
<p>Repeat the process to add a recond role:</p>
<ul>
<li>For the <em>Name</em> field, enter <code>username</code> &lt;&ndash; Enter this exactly!</li>
<li>Leave <em><strong>Namespace</strong></em> blank.</li>
<li>For <em><strong>Source</strong></em>, ensure <code>Attribute</code> is selected (default).</li>
<li>For <em><strong>Source attribute</strong></em>, select <code>user.mail</code> from the dropdown.</li>
</ul>
<p>Click <strong>Save</strong> to add the claim.</p>
<p><img src="13.png" alt="13"></p>
<p>Once you&rsquo;ve added the two new claims, your Attributes &amp; Roles should look as follows:</p>
<p><img src="14.png" alt="14"></p>
<h3 id="download-the-saml-signing-certificate">Download the SAML Signing Certificate</h3>
<p>Back on the SAML configuration page, scroll down to Section 3 - <strong>SAML Signing Certificate</strong>, and click to download the <strong>Base64</strong> certificate (see the image below).</p>
<h3 id="copy-the-azure-ad-application-urls">Copy the Azure AD Application URLs</h3>
<p>Next, under Section 4 - <strong>Set up Netskope Cloud Exchange</strong>, copy the <strong>Login URL</strong>, <strong>Logout URL</strong>, and <strong>Azure AD Identifier</strong> URL. You will need to paste these into the Cloud Exchange UI in the next section.</p>
<p><img src="15.png" alt="15"></p>
<h2 id="add-users--groups-to-the-enterprise-application">Add Users &amp; Groups to the Enterprise Application</h2>
<p>The last step we need to perform in Azure AD is to assign users and/or groups to the Cloud Exchange app to provide them with access. We will also assign either the <strong>Read-Only</strong> or <strong>Admin</strong> roles we created earlier to these users/groups to grant them the appropriate permissions within CE.</p>
<p>From the left-side menu within the Cloud Exchange Enterprise Application, select <strong>Users and groups</strong>, then click <strong>Add user/group</strong>.</p>
<p><img src="16.png" alt="16"></p>
<p>Select the users and/or groups that are permitted to use the Cloud Exchange application. You <strong>MUST</strong> also assign a role to the selected users/groups; ie: <code>CE-Admin</code> (read/write), or <code>CE-ReadOnly</code> (read-only).</p>
<p><strong>WARNING: If you do not assign a role, SSO will fail when the user attempts to sign in. Also, DO NOT assign the default <code>User</code> role you see in the list: this will also cause SSO to fail. You must only use the roles that you explicitly created in Azure AD yourself.</strong></p>
<p><img src="17.png" alt="17"></p>
<p>After assigning users/groups and applicable roles, your user/group list should look similar to the below:</p>
<p><img src="18.png" alt="18"></p>
<h2 id="finish-the-sso-configuration-in-cloud-exchange">Finish the SSO Configuration in Cloud Exchange</h2>
<p>Return to the <strong>SSO Configuration</strong> section of the Cloud Exchange UI (<strong>Settings &gt; Users &gt; SSO Configuration</strong>).</p>
<h3 id="copy-the-azure-app-urls">Copy the Azure app URLs</h3>
<p>For the 3 Identity Provider URL fields in the Cloud Exchange SSO configuration, paste the corresponding Azure AD Application URLs you copied when configuring SAML on the Azure AD side. See the table below for mapping:</p>
<table>
<thead>
<tr>
<th>Cloud Exchange Field</th>
<th>Azure AD SAML Config Field</th>
</tr>
</thead>
<tbody>
<tr>
<td>Identity Provider Issuer URL</td>
<td>Azure AD Identifier URL</td>
</tr>
<tr>
<td>Identity provider SSO URL</td>
<td>Login URL</td>
</tr>
<tr>
<td>Identity provider SLO URL</td>
<td>Logout URL</td>
</tr>
</tbody>
</table>
<p><img src="19.png" alt="19"></p>
<h3 id="copy-the-saml-signing-certificate">Copy the SAML Signing Certificate</h3>
<p>Open the Base64 SAML Signing Certificate you downloaded from Azure AD earlier in a text editor such as Notepad or TextEdit. Don&rsquo;t use MS Word. The certificate will have a <code>.cer</code> extension.</p>
<p>Copy the contents of the certificate file into the <code>Public x509 Certificate</code> field in the Cloud Exchange SSO config (see the image above).</p>
<p>Save your SSO Configuration when done.</p>
<h2 id="testing-the-sso-configuration">Testing the SSO Configuration</h2>
<p>Open a new Incognito window (to avoid any potential issues with caching) and point your browser to the URL of your Cloud Exchange deployment.</p>
<p>If you enabled the &ldquo;SSO&rdquo; checkbox as instructed at the beginning of this guide, you will two options when reaching Cloud Exchange:</p>
<ol>
<li>Login with SSO</li>
<li>Login with Username/Password</li>
</ol>
<p>Option #2 is used for local login (ie: the default <code>admin</code> user, or any user manually added to the user list in CE).</p>
<p><img src="20.png" alt="20"></p>
<p>Select <strong>Login with SSO</strong>. You should be redirected to Azure AD to sign in.</p>
<p><img src="21.png" alt="21"></p>
<p>Upon entering your user credentials, you should be authenticated and redirected to the Cloud Exchange interface. In the example below, the Adele user was assigned the <strong>CE-ReadOnly</strong> role, so almost all of the <strong>Settings</strong> menu is hidden.</p>
<p><img src="22.png" alt="22"></p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>If you are having issues signing in, first, look at which platform is giving you an error: Azure AD, or Cloud Exchange?
If the error you are presented with is from Azure AD, then there is likely an issue with your config on the Azure AD side. Double-check your URLs and/or whether the user you are attempting to sign in as is assigned to the application (or present in the group assigned to the app).</p>
<p>In the image below, my <code>nathan@lightwave.cloud</code> user was unable to sign in, as they were not assigned to the application in Azure AD.</p>
<p><img src="23.png" alt="23"></p>
<p>If you are getting an error from Cloud Exchange, then you have likely stuffed up the URLs entered into either CE or Azure AD, not added the custom <code>username</code> and <code>roles</code> claims in Azure AD, or not assigned any roles to the user you are signing in as.</p>
<p>If you get the error <code>{&quot;detail&quot;:&quot;Method Not Allowed&quot;}</code>, check that the URLs copied into both Azure AD and Cloud Exchange are correct and in the right place.</p>
<p>If you get the error <code>{&quot;detail&quot;:&quot;Could not authenticate. username/roles attribute not set.&quot;}</code>, then check that you added the <code>username</code> and <code>roles</code> claims in the SAML config, AND assigned roles correctly to users when you added them to the Enterprise Application in Azure AD.</p>
<p><img src="24.png" alt="24"></p>
<p>If you pass SSO fine but receive a red <code>Error while fetching data</code> message in CE, then there is a problem with the role you have assigned to the user. Ensure you entered <code>netskope-ce-write;netskope-ce-read</code> as the attribute for the Admin role (CE-Admin) and <code>netskope-ce-read</code> as the attribute for the Read-Only role (CE-ReadOnly). Additionally, check that you have assigned one of these roles to your impacted user: You may also get this error if the default <code>User</code> role is assigned.</p>
<p><img src="25.png" alt="25"></p>
<hr>
<h1 id="okta">Okta</h1>
<p><img src="27.png" alt="27"></p>
<h2 id="create-a-new-app-integration">Create a new App Integration</h2>
<p>Log in to your Okta administrator console and from the left-side menubar, navigate to <strong>Applications &gt; Applications</strong>.</p>
<p>Select <strong>Create App Integration</strong>.</p>
<p><img src="28.png" alt="28"></p>
<p>Select <strong>SAML 2.0</strong> as the sign-in method and click <strong>Next</strong>.</p>
<p><img src="29.png" alt="29"></p>
<p>On the next screen, set the App name to be Netskope Cloud Exchange and provide an app logo if required. Click Next to proceed to the Configure SAML section.</p>
<p><img src="30.png" alt="30"></p>
<h2 id="copy-the-cloud-exchange-sso-information-1">Copy the Cloud Exchange SSO information</h2>
<p>Log in to Cloud Exchange using the <code>admin</code> (super administrator) user, and navigate to <strong>Settings &gt; Users</strong> (this settings area will only be visible to the <code>admin</code> user).</p>
<p>Select the <strong>SSO Configuration</strong> tab, and toggle the <strong>SSO</strong> toggle <strong>ON</strong> (make sure you save this configuration).</p>
<p>Note down the first two &ldquo;Service Provider&rdquo; fields at the bottom of the screen (<code>Service Provider Entity ID</code> and <code>Service Provider ACS URL</code>). The image below maps which URL should be used for which config field in Okta.</p>
<p><img src="31.png" alt="31"></p>
<h2 id="configure-okta-saml-integration">Configure Okta SAML Integration</h2>
<p>Switch back to your Okta configuration and configure the settings as follows:</p>
<h3 id="copy-the-cloud-exchange-service-provider-urls">Copy the Cloud Exchange Service Provider URLs</h3>
<p>For the first two Service Provider URL fields in the Cloud Exchange SSO configuration, paste the corresponding URL into the appropriate field in Okta. See the table below for mapping:</p>
<table>
<thead>
<tr>
<th>Cloud Exchange Field</th>
<th>Okta SAML Config Field</th>
</tr>
</thead>
<tbody>
<tr>
<td>Service Provider Entity ID</td>
<td>Audience URL (SP Entity ID)</td>
</tr>
<tr>
<td>Service Provider ACS URL</td>
<td>Single sign on URL</td>
</tr>
<tr>
<td>Service Provider SLS URL</td>
<td>N/A - Not used</td>
</tr>
</tbody>
</table>
<h3 id="set-the-name-id-format">Set the Name ID format</h3>
<p>Ensure you change the <strong>Name ID format</strong> in Okta, from <em>Unspecified</em> to <em><strong>EmailAddress</strong></em>.</p>
<h3 id="add-additional-attributes">Add additional attributes</h3>
<p>You need to add two additional attribute statements to the Okta configuration: One called <code>username</code> and another called <code>roles</code>.</p>
<ul>
<li>The <code>username</code> attribute should have the value of <code>user.email</code>.</li>
<li>The <code>roles</code> attribute should have the value of <code>appuser.roles</code> (you will need to type this - it won&rsquo;t appear in the dropdown).</li>
</ul>
<p><img src="32.png" alt="32"></p>
<h3 id="finish-the-saml-configuration">Finish the SAML configuration</h3>
<p>When you are done, scroll to the bottom of the page and click <strong>Next</strong>.</p>
<p>Check the box &ldquo;<em>I&rsquo;m an Okta customer adding an internal app</em>&rdquo; and click <strong>Finish</strong>.</p>
<h3 id="open-the-okta-saml-20-steup-instructions">Open the Okta SAML 2.0 Steup Instructions</h3>
<p>On the next page, click the <strong>View Setup Instructions</strong> button inside the yellow box under the <strong>Sign On</strong> tab app.</p>
<p><img src="42.png" alt="42"></p>
<p>This will open a new tab containing the details we will need to copy back into the Cloud Exchange console.</p>
<p><img src="41.png" alt="41"></p>
<p>Leave this tab open for now as we still have some configuration left to do on the Okta side.</p>
<h2 id="create-the-roles-attribute-in-okta">Create the <code>roles</code> attribute in Okta</h2>
<p>Users can be assigned Read/Write or just Read access to the CE UI based on one of two roles assigned to them: <code>Admin</code> (read/write access) and <code>Read Only</code>. We need to create the <code>roles</code> attribute in Okta so that it can be used and assigned to the groups of IT admins who will use the CE application.</p>
<p>Navigate to <strong>Directory &gt; Profile Editor</strong> from the left-side menu, and select the <strong>Netskope Cloud Exchange User</strong> profile.</p>
<p><img src="33.png" alt="33"></p>
<p>Here you&rsquo;ll see the <code>username</code> attribute we added when we completed the SAML configuration, but the <code>roles</code> attribute is nowhere to be found! We need to create it manually.</p>
<p>Click the <strong>Add Attribute</strong> button.</p>
<p><img src="34.png" alt="34"></p>
<ul>
<li>For <strong>Display name</strong>, enter <code>Roles</code></li>
<li>For <strong>Variable name</strong>, enter <code>roles</code> &lt;&ndash; Case sensitive!</li>
<li>For <strong>Description</strong>, enter <code>Netskope Cloud Exchange Admin Roles</code></li>
</ul>
<p>Click <strong>Save</strong> at the bottom when you&rsquo;re done.</p>
<p><img src="35.png" alt="35"></p>
<h2 id="configure-user-groups-for-ce-access">Configure User Groups for CE Access</h2>
<p>Next, we need to create two groups: One for the users that will have read/write access to CE, and another for users that will have read-only access.</p>
<p>Navigate to <strong>Directory &gt; Groups</strong> from the left-side menu, and select the <strong>Add Group</strong> button.</p>
<p><img src="36.png" alt="36"></p>
<h3 id="create-the-read-only-and-admin-groups">Create the <code>Read-Only</code> and <code>Admin</code> groups</h3>
<p>Create two groups called <code>Netskope CE Read-Only</code> and <code>Netskope CE Admin</code> respectively.</p>
<p><img src="37.png" alt="37"></p>
<h3 id="assign-people-to-the-read-only-role">Assign people to the Read-Only role</h3>
<p>Click the <strong>Netskope CE Read-Only</strong> group you created from the group list to edit the group.</p>
<p>Under the <strong>People</strong> tab, click <strong>Assign People</strong> and assign the users who will have read-only access to the CE platform. Don&rsquo;t forget to click <strong>Save</strong>.</p>
<p><img src="38.png" alt="38"></p>
<p>Next, select the <strong>Applications</strong> tab and click <strong>Assign applications</strong>.</p>
<p><img src="39.png" alt="39"></p>
<p>Assign the <strong>Netskope Cloud Exchange</strong> application.</p>
<p>You will then be prompted to specify a role. Enter <code>netskope-ce-read</code></p>
<p><strong>WARNING: You must enter this exactly, or SSO will fail! It is case sensitive.</strong></p>
<p><img src="40.png" alt="40"></p>
<p>Select <strong>Save and Go Back</strong> to complete the configuration of the read-only group.</p>
<h3 id="assign-people-to-the-admin-role">Assign people to the Admin role</h3>
<p>Click the <strong>Netskope CE Admin</strong> group you created from the group list to edit the group.</p>
<p>Repeat the steps above, except this time select the people who will have read/write access to the CE platform. Don&rsquo;t forget to click <strong>Save</strong>.</p>
<p>When prompted to specify a role, enter <code>netskope-ce-write;netskope-ce-read</code></p>
<p><strong>WARNING: You must enter this exactly, or SSO will fail! It is case sensitive.</strong></p>
<p><img src="43.png" alt="43"></p>
<p>Select <strong>Save and Go Back</strong> to complete the configuration of the Admin group.</p>
<h2 id="finish-the-sso-configuration-in-cloud-exchange-1">Finish the SSO Configuration in Cloud Exchange</h2>
<p>Return to the <strong>SSO Configuration</strong> section of the Cloud Exchange UI (<strong>Settings &gt; Users &gt; SSO Configuration</strong>). Here we will use the details within the Setup Instructions that we opened (in a separate tab) earlier.</p>
<p><img src="41.png" alt="41"></p>
<p>For the below fields in the Cloud Exchange SSO configuration, paste the corresponding information from the Okta Setup Instructions. See the table below for mapping:</p>
<table>
<thead>
<tr>
<th>Cloud Exchange Field</th>
<th>Okta Setup Instructions Field</th>
</tr>
</thead>
<tbody>
<tr>
<td>Identity Provider Issuer URL</td>
<td>Identity Provider Issuer</td>
</tr>
<tr>
<td>Identity provider SSO URL</td>
<td>Identity Provider Single Sign-On URL</td>
</tr>
<tr>
<td>Identity provider SLO URL</td>
<td>Identity Provider Single Sign-On URL</td>
</tr>
<tr>
<td>Public x509 Certificate</td>
<td>X.509 Certificate</td>
</tr>
</tbody>
</table>
<p>The SLO URL field is not needed, but cannot be blank. Copy the same URL used for the Identity provider SSO URL for this field.</p>
<p><img src="44.png" alt="44"></p>
<p>Save your SSO Configuration when done.</p>
<h2 id="testing-the-sso-configuration-1">Testing the SSO Configuration</h2>
<p>Open a new Incognito window (to avoid any potential issues with caching) and point your browser to the URL of your Cloud Exchange deployment.</p>
<p>If you enabled the &ldquo;SSO&rdquo; checkbox as instructed at the beginning of this guide, you will two options when reaching Cloud Exchange:</p>
<ol>
<li>Login with SSO</li>
<li>Login with Username/Password</li>
</ol>
<p>Option #2 is used for local login (ie: the default <code>admin</code> user, or any user manually added to the user list in CE).</p>
<p><img src="20.png" alt="20"></p>
<p>Select <strong>Login with SSO</strong>. You should be redirected to Okta to sign in.</p>
<p><img src="45.png" alt="45"></p>
<p>Upon entering your user credentials, you should be authenticated and redirected to the Cloud Exchange interface. In the example below, the Ben user was assigned to the <strong>Netskope CE Read-Only</strong> group, so almost all of the <strong>Settings</strong> menu is hidden.</p>
<p><img src="46.png" alt="46"></p>
<h2 id="troubleshooting-1">Troubleshooting</h2>
<p>If you are having issues signing in, first, look at which platform is giving you an error: Okta, or Cloud Exchange?
If the error you are presented with is from Okta, then the issue is likely with your config on the Okta side. Double-check your URLs and/or whether the user you are attempting to sign in as is assigned to either the <em>Netskope CE Read-Only</em> or <em>Netskope CE Admin</em> groups.</p>
<p>If you are getting an error from Cloud Exchange, then you have likely stuffed up the URLs entered into either CE or Azure AD, not added the custom <code>username</code> and <code>roles</code> attributes, or not typed the name of the role correctly (ie: <code>netskope-ce-read</code> and <code>netskope-ce-write;netskope-ce-read</code>).</p>
<p>If you get the error <code>{&quot;detail&quot;:&quot;Method Not Allowed&quot;}</code>, check that the URLs copied into both Okta and Cloud Exchange are correct and in the right place.</p>
<p>If you get the error <code>{&quot;detail&quot;:&quot;Could not authenticate. username/roles attribute not set.&quot;}</code>, then check that you have added the <code>username</code> and <code>roles</code> claims in the SAML config.</p>
<p><img src="24.png" alt="24"></p>
<p>If you pass SSO fine but receive a red <code>Error while fetching data</code> message in CE, then there is a problem with the role you have assigned to the user. Ensure you entered <code>netskope-ce-write;netskope-ce-read</code> as the attribute for the Admin group (Netskope CE Admin) and <code>netskope-ce-read</code> as the attribute for the Read-Only role (Netskope CE Read-Only). Additionally, check that you have assigned one of these groups to your impacted user: You may also get this error if anything else has been entered into the role field apart from the above two accepted strings.</p>
<p><img src="25.png" alt="25"></p>

            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://nathancatania.com/tags/netskope">netskope</a></span><span class="tag"><a href="https://nathancatania.com/tags/sso">sso</a></span><span class="tag"><a href="https://nathancatania.com/tags/azure">azure</a></span><span class="tag"><a href="https://nathancatania.com/tags/okta">okta</a></span><span class="tag"><a href="https://nathancatania.com/tags/lab">lab</a></span><span class="tag"><a href="https://nathancatania.com/tags/notes">notes</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>3053 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2022-03-06</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Read other posts</span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="https://nathancatania.com/posts/deploy-guacamole-ssl-saml/">
                                <span class="button__icon">←</span>
                                <span class="button__text">Deploy Apache Guacamole with SSL &amp; SAML (Azure AD &amp; Okta) integration</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="https://nathancatania.com/posts/deploy-zapp-mobile-with-intune/">
                                <span class="button__text">Deploy Zscaler Client Connector with Intune (iOS &amp; Android)</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2024</span>
            
                <span><a href="https://nathancatania.com">Nathan Catania</a></span>
            
            <span> <a href="https://nathancatania.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span><a href="https://github.com/nathancatania/website">Source</a></span>
            <span><a href="https://github.com/rhazdon">Theme</a></span>
        </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.858712b4b19060b33e6a3b52df9749f413894a75772f4d0b4683380c0ce08c6f93623d63068ef5ae4719980bcaa15ad536694c42897b88c4826c6ece21918827.js" integrity="sha512-hYcStLGQYLM&#43;ajtS35dJ9BOJSnV3L00LRoM4DAzgjG&#43;TYj1jBo71rkcZmAvKoVrVNmlMQol7iMSCbG7OIZGIJw=="></script>




    </body>
</html>
